<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Menu</title>
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --primary-darker: #1e40af;
            --primary-light: rgba(59, 130, 246, 0.8);
            --primary-glow: rgba(59, 130, 246, 0.4);
        }

        .theme-red {
            --primary-color: #ef4444;
            --primary-dark: #dc2626;
            --primary-darker: #b91c1c;
            --primary-light: rgba(239, 68, 68, 0.8);
            --primary-glow: rgba(239, 68, 68, 0.4);
        }

        .theme-green {
            --primary-color: #10b981;
            --primary-dark: #059669;
            --primary-darker: #047857;
            --primary-light: rgba(16, 185, 129, 0.8);
            --primary-glow: rgba(16, 185, 129, 0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            padding: 50px;
            gap: 8px;
        }

        .custom-banner {
            width: 300px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 50%, var(--primary-darker) 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .banner-text {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-align: center;
        }

        .main-layout {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .menu-layout {
            position: relative;
            width: 300px;
        }

        .player-info-panel {
            width: 200px;
            background: rgba(30, 30, 30, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 12px;
            display: none;
        }

        .player-info-panel.visible {
            display: block;
        }

        .player-info-header {
            font-size: 14px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
            text-align: center;
        }

        .player-info-item {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .player-info-label {
            color: #9ca3af;
        }

        .player-info-value {
            color: #ffffff;
            font-weight: bold;
        }

        .player-info-value.online {
            color: #10b981;
        }

        .player-info-value.offline {
            color: #ef4444;
        }

        .scrollbar-container {
            width: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            position: absolute;
            left: -12px;
            top: 0;
            z-index: 10;
            opacity: 1;
            visibility: visible;
            transition: all 0.3s ease;
        }

        .menu-container {
            width: 300px;
            background: transparent;
            border: none;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .search-container {
            width: 300px;
            background: rgba(30, 30, 30, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 12px;
            display: none;
            margin-bottom: 8px;
        }

        .search-container.visible {
            display: block;
        }

        .search-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 8px 12px;
            color: white;
            font-size: 13px;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-glow);
        }

        .search-results {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 8px;
        }

        .search-result-item {
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            margin-bottom: 2px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: var(--primary-light);
        }

        .search-result-path {
            color: #9ca3af;
            font-size: 10px;
        }

        .theme-selector-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .theme-selector-modal.visible {
            display: flex;
        }

        .theme-selector-content {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            width: 300px;
        }

        .theme-selector-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .theme-options {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .theme-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .theme-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .theme-option.active {
            background: var(--primary-light);
        }

        .theme-circle {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .theme-option.active .theme-circle {
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .theme-circle.blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .theme-circle.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .theme-circle.green {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .theme-name {
            font-size: 12px;
            color: #9ca3af;
            font-weight: normal;
        }

        .theme-option.active .theme-name {
            color: white;
        }

        .theme-close-button {
            width: 100%;
            background: var(--primary-color);
            border: none;
            border-radius: 6px;
            color: white;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-close-button:hover {
            background: var(--primary-dark);
        }

        .menu-section {
            display: none;
        }

        .menu-body {
            background: transparent;
            overflow: hidden;
            position: relative;
            min-height: 280px;
        }

        .menu-items {
            transition: transform 0.15s ease;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            height: 35px;
            position: relative;
            margin-bottom: 2px;
            border-radius: 4px;
        }

        .menu-item:hover:not(.selected) {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .menu-item.selected {
            background: var(--primary-light);
            border-color: var(--primary-color);
            color: white;
            transition: all 0.2s ease;
        }

        .menu-item.selected::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, var(--primary-glow), transparent 50%);
            pointer-events: none;
        }

        .menu-item-text {
            font-size: 13px;
            font-weight: normal;
            color: inherit;
        }

        .menu-item-arrow {
            color: #9ca3af;
            font-size: 14px;
            font-weight: bold;
        }

        .menu-item.selected .menu-item-arrow {
            color: white;
        }

        .menu-item.toggle {
            justify-content: space-between;
        }

        .toggle-switch {
            width: 32px;
            height: 18px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 9px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-glow);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 1px;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(14px);
            background: #f8fafc;
        }

        .scrollbar-thumb {
            width: 6px;
            background: linear-gradient(180deg, var(--primary-color), var(--primary-dark));
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            top: 0;
            box-shadow: 0 2px 8px var(--primary-glow);
        }

        .scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        .menu-footer {
            background: rgba(22, 22, 22, 0.9);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            width: 300px;
            margin-top: 5px;
            position: relative;
            transition: all 0.3s ease;
        }

        .menu-build {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: #9ca3af;
            font-weight: normal;
        }

        .menu-page {
            font-size: 10px;
            color: #9ca3af;
            font-weight: normal;
        }

        .back-button {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            background: var(--primary-light);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        .back-button.visible {
            display: flex;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(20, 20, 20, 0.9) 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            border: 1px solid var(--primary-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 20px var(--primary-glow);
            transform: translateX(120%);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
            font-size: 14px;
            font-weight: bold;
            min-width: 200px;
            text-align: center;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            opacity: 0.1;
            z-index: -1;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.hide {
            transform: translateX(120%);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="custom-banner">
        <div class="banner-text">Custom Banner</div>
    </div>

    <div class="search-container" id="searchContainer">
        <input type="text" class="search-input" id="searchInput" placeholder="Search features..." autocomplete="off">
        <div class="search-results" id="searchResults"></div>
    </div>

    <div class="main-layout">
        <div class="menu-layout">
            <div class="scrollbar-container">
                <div class="scrollbar-thumb" id="scrollThumb"></div>
            </div>

            <div class="menu-container">
                <button class="back-button" id="backButton">&larr;</button>
                <div class="menu-section">Main menu</div>
                
                <div class="menu-body">
                    <div class="menu-items" id="menuItems">
                        <!-- Menu items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <div class="player-info-panel" id="playerInfoPanel">
            <div class="player-info-header" id="playerInfoName">CRQOLQVRQO</div>
            <div class="player-info-item">
                <span class="player-info-label">Distance</span>
                <span class="player-info-value" id="playerDistance">126.0m</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Server ID</span>
                <span class="player-info-value" id="playerServerId">302902</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Health</span>
                <span class="player-info-value" id="playerHealth">200</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Armor</span>
                <span class="player-info-value" id="playerArmor">0</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Weapon</span>
                <span class="player-info-value" id="playerWeapon">Unarmed</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Vehicle</span>
                <span class="player-info-value" id="playerVehicle">Outside</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Alive</span>
                <span class="player-info-value online" id="playerAlive">Alive</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Speed</span>
                <span class="player-info-value" id="playerSpeed">0km/h</span>
            </div>
            <div class="player-info-item">
                <span class="player-info-label">Friend</span>
                <span class="player-info-value" id="playerFriend">No</span>
            </div>
        </div>
    </div>

    <div class="menu-footer">
        <div class="menu-build">
            <span>Insanity.lua</span>
            <span>Build: 262119</span>
        </div>
        <div class="menu-page" id="pageIndicator">1 / 9</div>
    </div>

    <!-- Theme Selector Modal -->
    <div class="theme-selector-modal" id="themeModal">
        <div class="theme-selector-content">
            <div class="theme-selector-title">Choose Theme Color</div>
            <div class="theme-options">
                <div class="theme-option active" id="themeBlue" onclick="selectTheme('blue')">
                    <div class="theme-circle blue"></div>
                    <div class="theme-name">Blue</div>
                </div>
                <div class="theme-option" id="themeRed" onclick="selectTheme('red')">
                    <div class="theme-circle red"></div>
                    <div class="theme-name">Red</div>
                </div>
                <div class="theme-option" id="themeGreen" onclick="selectTheme('green')">
                    <div class="theme-circle green"></div>
                    <div class="theme-name">Green</div>
                </div>
            </div>
            <button class="theme-close-button" onclick="closeThemeSelector()">Apply & Close</button>
        </div>
    </div>

    <script>
        // Global variables
        var selectedIndex = 0;
        var scrollOffset = 0;
        var currentMenu = 'main';
        var menuHistory = [];
        var searchActive = false;
        var currentTheme = 'blue';
        var themes = ['blue', 'red', 'green'];
        var currentThemeIndex = 0;
        
        // Menu data structure
        var menuData = {
            main: {
                title: 'Main Menu',
                pageNumber: 1,
                items: [
                    { text: 'Player', id: 'player', type: 'submenu', arrow: '»' },
                    { text: 'Server', id: 'server', type: 'submenu', arrow: '»' },
                    { text: 'Weapon', id: 'weapon', type: 'submenu', arrow: '»' },
                    { text: 'Combat', id: 'combat', type: 'submenu', arrow: '»' },
                    { text: 'Vehicle', id: 'vehicle', type: 'submenu', arrow: '»' },
                    { text: 'Visual', id: 'visual', type: 'submenu', arrow: '»' },
                    { text: 'Miscellaneous', id: 'misc', type: 'submenu', arrow: '»' },
                    { text: 'Settings', id: 'settings', type: 'submenu', arrow: '»' },
                    { text: 'Search', id: 'search', type: 'action', arrow: 'S' }
                ]
            },
            player: {
                title: 'Player Options',
                pageNumber: 2,
                items: [
                    { text: 'Set Health', id: 'sethealth', type: 'action', arrow: '»' },
                    { text: 'Set Armor', id: 'setarmor', type: 'action', arrow: '»' },
                    { text: 'Invisible', id: 'invisible', type: 'toggle', state: false },
                    { text: 'Never Wanted', id: 'neverwanted', type: 'toggle', state: false },
                    { text: 'Super Speed', id: 'superspeed', type: 'toggle', state: false },
                    { text: 'Teleport to Waypoint', id: 'tpwaypoint', type: 'action', arrow: '->' },
                    { text: 'Noclip Mode', id: 'noclip', type: 'toggle', state: false },
                    { text: 'Infinite Stamina', id: 'infinitestamina', type: 'toggle', state: false },
                    { text: 'Fast Swim', id: 'fastswim', type: 'toggle', state: false },
                    { text: 'Ragdoll Disabled', id: 'noragdoll', type: 'toggle', state: false }
                ]
            },
            server: {
                title: 'Server Options',
                pageNumber: 3,
                items: [
                    { text: 'Player List', id: 'playerlist', type: 'submenu', arrow: '»' },
                    { text: 'Kick Player', id: 'kickplayer', type: 'action', arrow: 'X' },
                    { text: 'Ban Player', id: 'banplayer', type: 'action', arrow: 'X' },
                    { text: 'Spectate Player', id: 'spectate', type: 'toggle', state: false }
                ]
            },
            playerlist: {
                title: 'Players Online',
                pageNumber: 10,
                items: [
                    { text: 'CRQOLQVRQO', id: 'player1', type: 'player', arrow: 'P', data: { distance: '126.0m', serverId: '302902', health: '200', armor: '0', weapon: 'Unarmed', vehicle: 'Outside', alive: 'Alive', speed: '0km/h', friend: 'No' }},
                    { text: 'PlayerTwo', id: 'player2', type: 'player', arrow: 'P', data: { distance: '45.2m', serverId: '123456', health: '150', armor: '50', weapon: 'Pistol', vehicle: 'Adder', alive: 'Alive', speed: '85km/h', friend: 'Yes' }},
                    { text: 'GamerXYZ', id: 'player3', type: 'player', arrow: 'P', data: { distance: '203.7m', serverId: '789012', health: '0', armor: '0', weapon: 'None', vehicle: 'Outside', alive: 'Dead', speed: '0km/h', friend: 'No' }},
                    { text: 'ProPlayer', id: 'player4', type: 'player', arrow: 'P', data: { distance: '89.1m', serverId: '456789', health: '180', armor: '75', weapon: 'Assault Rifle', vehicle: 'Zentorno', alive: 'Alive', speed: '120km/h', friend: 'No' }}
                ]
            },
            weapon: {
                title: 'Weapon Options',
                pageNumber: 4,
                items: [
                    { text: 'Give All Weapons', id: 'giveallweapons', type: 'action', arrow: 'W' },
                    { text: 'Remove All Weapons', id: 'removeallweapons', type: 'action', arrow: 'X' },
                    { text: 'Pistol', id: 'givepistol', type: 'action', arrow: '+' },
                    { text: 'Assault Rifle', id: 'giveassaultrifle', type: 'action', arrow: '+' },
                    { text: 'Sniper Rifle', id: 'givesniper', type: 'action', arrow: '+' },
                    { text: 'RPG', id: 'giverpg', type: 'action', arrow: '+' }
                ]
            },
            combat: {
                title: 'Combat Options',
                pageNumber: 5,
                items: [
                    { text: 'God Mode', id: 'godmode', type: 'toggle', state: false },
                    { text: 'Infinite Ammo', id: 'infiniteammo', type: 'toggle', state: false },
                    { text: 'No Reload', id: 'noreload', type: 'toggle', state: true },
                    { text: 'Rapid Fire', id: 'rapidfire', type: 'toggle', state: false },
                    { text: 'Super Jump', id: 'superjump', type: 'toggle', state: false },
                    { text: 'Fast Run', id: 'fastrun', type: 'toggle', state: false },
                    { text: 'Explosive Bullets', id: 'explosivebullets', type: 'toggle', state: false },
                    { text: 'Kill All NPCs', id: 'killallnpcs', type: 'action', arrow: 'X' }
                ]
            },
            vehicle: {
                title: 'Vehicle Options',
                pageNumber: 6,
                items: [
                    { text: 'Spawn Adder', id: 'spawnadder', type: 'action', arrow: 'C' },
                    { text: 'Spawn Zentorno', id: 'spawnzentorno', type: 'action', arrow: 'C' },
                    { text: 'Fix Vehicle', id: 'fixvehicle', type: 'action', arrow: 'F' },
                    { text: 'Vehicle God Mode', id: 'vehiclegodmode', type: 'toggle', state: false },
                    { text: 'Infinite Fuel', id: 'infinitefuel', type: 'toggle', state: false }
                ]
            },
            visual: {
                title: 'Visual Options',
                pageNumber: 7,
                items: [
                    { text: 'Night Vision', id: 'nightvision', type: 'toggle', state: false },
                    { text: 'Thermal Vision', id: 'thermalvision', type: 'toggle', state: false },
                    { text: 'No HUD', id: 'nohud', type: 'toggle', state: false }
                ]
            },
            misc: {
                title: 'Miscellaneous',
                pageNumber: 8,
                items: [
                    { text: 'Freeze Time', id: 'freezetime', type: 'toggle', state: false },
                    { text: 'Change Weather', id: 'changeweather', type: 'action', arrow: 'W' }
                ]
            },
            settings: {
                title: 'Settings',
                pageNumber: 9,
                items: [
                    { text: 'Save Config', id: 'saveconfig', type: 'action', arrow: 'S' },
                    { text: 'Load Config', id: 'loadconfig', type: 'action', arrow: 'L' },
                    { text: 'Theme Color', id: 'themecolor', type: 'action', arrow: 'T' }
                ]
            }
        };

        // DUI Message handler
        window.addEventListener('message', function(event) {
            console.log('Received message:', event.data);
            try {
                var data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
                handleLuaMessage(data);
            } catch (e) {
                console.error('Error parsing message:', e);
            }
        });

        function handleLuaMessage(data) {
            switch(data.action) {
                case 'showMenu':
                    console.log('Showing menu');
                    break;
                case 'hideMenu':
                    console.log('Hiding menu');
                    break;
                case 'updateMenu':
                    updateMenu(data.items, data.title);
                    break;
                case 'notification':
                    showNotification(data.message, data.type);
                    break;
            }
        }

        // Search functionality
        function getAllSearchableItems() {
            var searchableItems = [];
            
            function addItems(menuId, menuName, items) {
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    if (item.type !== 'submenu' || !menuData[item.id]) {
                        searchableItems.push({
                            text: item.text,
                            id: item.id,
                            type: item.type,
                            menuId: menuId,
                            menuName: menuName,
                            path: menuId === 'main' ? item.text : menuName + ' > ' + item.text
                        });
                    }
                }
            }
            
            var menuKeys = Object.keys(menuData);
            for (var i = 0; i < menuKeys.length; i++) {
                var menuId = menuKeys[i];
                var menu = menuData[menuId];
                addItems(menuId, menu.title, menu.items);
            }
            
            return searchableItems;
        }

        function performSearch(query) {
            var searchResults = document.getElementById('searchResults');
            if (!query.trim()) {
                searchResults.innerHTML = '';
                return;
            }

            var searchableItems = getAllSearchableItems();
            var results = [];
            
            for (var i = 0; i < searchableItems.length && results.length < 10; i++) {
                if (searchableItems[i].text.toLowerCase().indexOf(query.toLowerCase()) !== -1) {
                    results.push(searchableItems[i]);
                }
            }

            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-result-item">No results found</div>';
                return;
            }

            var resultsHtml = '';
            for (var i = 0; i < results.length; i++) {
                var result = results[i];
                resultsHtml += '<div class="search-result-item" onclick="navigateToSearchResult(\'' + result.menuId + '\', \'' + result.id + '\')">';
                resultsHtml += '<div>' + result.text + '</div>';
                resultsHtml += '<div class="search-result-path">' + result.path + '</div>';
                resultsHtml += '</div>';
            }
            searchResults.innerHTML = resultsHtml;
        }

        function navigateToSearchResult(menuId, itemId) {
            hideSearch();
            
            if (menuId !== currentMenu) {
                menuHistory = [];
                if (menuId !== 'main') {
                    menuHistory.push('main');
                }
                currentMenu = menuId;
                renderMenu(menuId);
            }

            var menu = menuData[currentMenu];
            var itemIndex = -1;
            for (var i = 0; i < menu.items.length; i++) {
                if (menu.items[i].id === itemId) {
                    itemIndex = i;
                    break;
                }
            }
            
            if (itemIndex !== -1) {
                selectedIndex = itemIndex;
                updateSelection();
                updatePageIndicator();
                showNotification('Found: ' + menu.items[itemIndex].text);
            }
        }

        function showSearch() {
            document.getElementById('searchContainer').classList.add('visible');
            document.getElementById('searchInput').focus();
            searchActive = true;
        }

        function hideSearch() {
            document.getElementById('searchContainer').classList.remove('visible');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
            searchActive = false;
        }

        // Theme management
        function changeTheme(direction) {
            if (direction === 'left') {
                currentThemeIndex = (currentThemeIndex - 1 + themes.length) % themes.length;
            } else if (direction === 'right') {
                currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            }
            
            var newTheme = themes[currentThemeIndex];
            selectTheme(newTheme);
        }

        function selectTheme(theme) {
            currentTheme = theme;
            currentThemeIndex = themes.indexOf(theme);
            
            // Remove all theme classes
            document.body.classList.remove('theme-red', 'theme-green');
            
            // Add selected theme class
            if (theme !== 'blue') {
                document.body.classList.add('theme-' + theme);
            }
            
            // Update active theme option
            var themeOptions = document.querySelectorAll('.theme-option');
            for (var i = 0; i < themeOptions.length; i++) {
                themeOptions[i].classList.remove('active');
            }
            document.getElementById('theme' + theme.charAt(0).toUpperCase() + theme.slice(1)).classList.add('active');
            
            showNotification('Theme: ' + theme.charAt(0).toUpperCase() + theme.slice(1));
        }

        function showThemeSelector() {
            document.getElementById('themeModal').classList.add('visible');
        }

        function closeThemeSelector() {
            document.getElementById('themeModal').classList.remove('visible');
        }

        // Player info display
        function showPlayerInfo(playerData) {
            var panel = document.getElementById('playerInfoPanel');
            
            document.getElementById('playerInfoName').textContent = playerData.text;
            document.getElementById('playerDistance').textContent = playerData.data.distance;
            document.getElementById('playerServerId').textContent = playerData.data.serverId;
            document.getElementById('playerHealth').textContent = playerData.data.health;
            document.getElementById('playerArmor').textContent = playerData.data.armor;
            document.getElementById('playerWeapon').textContent = playerData.data.weapon;
            document.getElementById('playerVehicle').textContent = playerData.data.vehicle;
            document.getElementById('playerAlive').textContent = playerData.data.alive;
            document.getElementById('playerSpeed').textContent = playerData.data.speed;
            document.getElementById('playerFriend').textContent = playerData.data.friend;
            
            // Update status colors
            var aliveElement = document.getElementById('playerAlive');
            aliveElement.className = 'player-info-value';
            if (playerData.data.alive === 'Alive') {
                aliveElement.classList.add('online');
            } else {
                aliveElement.classList.add('offline');
            }
            
            panel.classList.add('visible');
        }

        function hidePlayerInfo() {
            document.getElementById('playerInfoPanel').classList.remove('visible');
        }

        function updatePageIndicator() {
            var menu = menuData[currentMenu];
            var totalItems = menu.items.length;
            var currentPosition = selectedIndex + 1;
            
            document.getElementById('pageIndicator').textContent = currentPosition + ' / ' + totalItems;
        }
        
        function renderMenu(menuId) {
            var menu = menuData[menuId];
            var container = document.getElementById('menuItems');
            var backButton = document.getElementById('backButton');
            
            container.innerHTML = '';
            
            // Show/hide back button
            if (menuId !== 'main') {
                backButton.classList.add('visible');
            } else {
                backButton.classList.remove('visible');
            }
            
            // Render menu items
            for (var i = 0; i < menu.items.length; i++) {
                var item = menu.items[i];
                var menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                if (i === selectedIndex) menuItem.classList.add('selected');
                
                if (item.type === 'toggle') {
                    menuItem.classList.add('toggle');
                    menuItem.innerHTML = '<span class="menu-item-text">' + item.text + '</span>' +
                        '<div class="toggle-switch ' + (item.state ? 'active' : '') + '" onclick="toggleFeature(\'' + item.id + '\', event)" data-toggle-id="' + item.id + '"></div>';
                } else {
                    menuItem.innerHTML = '<span class="menu-item-text">' + item.text + '</span>' +
                        '<span class="menu-item-arrow">' + item.arrow + '</span>';
                }
                
                // Add hover events for player items
                if (item.type === 'player') {
                    (function(currentItem) {
                        menuItem.addEventListener('mouseenter', function() {
                            showPlayerInfo(currentItem);
                        });
                        menuItem.addEventListener('mouseleave', function() {
                            hidePlayerInfo();
                        });
                    })(item);
                }
                
                // Add click handler
                (function(currentId, currentType, currentIndex) {
                    menuItem.onclick = function() {
                        selectItem(currentId, currentType, currentIndex);
                    };
                })(item.id, item.type, i);
                
                container.appendChild(menuItem);
            }
            
            // Reset scroll and selection
            selectedIndex = 0;
            scrollOffset = 0;
            updateScroll();
            updateSelection();
            updateScrollbarVisibility();
            updatePageIndicator();
        }
        
        function updateScrollbarVisibility() {
            var menuItems = document.querySelectorAll('.menu-item');
            var scrollbarContainer = document.querySelector('.scrollbar-container');
            var visibleItems = 8;
            var itemHeight = 37;
            
            var actualItemCount = menuItems.length;
            var maxDisplayItems = Math.min(actualItemCount, visibleItems);
            var containerHeight = maxDisplayItems * itemHeight;
            
            scrollbarContainer.style.height = containerHeight + 'px';
            document.querySelector('.menu-body').style.height = containerHeight + 'px';
            scrollbarContainer.classList.add('visible');
        }
        
        function selectItem(id, type, index) {
            selectedIndex = index;
            updateSelection();
            updatePageIndicator();
            
            if (type === 'submenu' && menuData[id]) {
                menuHistory.push(currentMenu);
                currentMenu = id;
                renderMenu(id);
            } else if (type === 'action') {
                if (id === 'search') {
                    showSearch();
                    return;
                } else if (id === 'themecolor') {
                    showThemeSelector();
                    return;
                }
                console.log('Action triggered: ' + id);
                showNotification(menuData[currentMenu].items[index].text);
            } else if (type === 'toggle') {
                var menu = menuData[currentMenu];
                var item = menu.items[index];
                item.state = !item.state;
                
                var toggleSwitches = document.querySelectorAll('.toggle-switch');
                var correctToggle = null;
                
                for (var i = 0; i < toggleSwitches.length; i++) {
                    if (toggleSwitches[i].getAttribute('data-toggle-id') === item.id) {
                        correctToggle = toggleSwitches[i];
                        break;
                    }
                }
                
                if (correctToggle) {
                    if (item.state) {
                        correctToggle.classList.add('active');
                        correctToggle.style.boxShadow = '0 0 10px rgba(59, 130, 246, 0.5)';
                    } else {
                        correctToggle.classList.remove('active');
                        correctToggle.style.boxShadow = 'none';
                    }
                }
                
                showNotification(item.text + ' ' + (item.state ? 'Enabled' : 'Disabled'));
                console.log('Toggle ' + id + ': ' + (item.state ? 'ON' : 'OFF'));
            } else if (type === 'player') {
                showNotification('Selected: ' + menuData[currentMenu].items[index].text);
                console.log('Player selected: ' + id);
            }
        }
        
        function showNotification(message) {
            // Remove existing notification
            var existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            // Create new notification
            var notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(function() {
                notification.classList.add('show');
            }, 10);
            
            // Hide after 2.5 seconds
            setTimeout(function() {
                notification.classList.add('hide');
                setTimeout(function() {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 500);
            }, 2500);
        }
        
        function toggleFeature(id, event) {
            event.stopPropagation();
            var menu = menuData[currentMenu];
            var item = null;
            
            for (var i = 0; i < menu.items.length; i++) {
                if (menu.items[i].id === id) {
                    item = menu.items[i];
                    break;
                }
            }
            
            if (item) {
                item.state = !item.state;
                var toggleSwitch = event.target;
                
                // Add smooth animation
                toggleSwitch.style.transform = 'scale(0.95)';
                setTimeout(function() {
                    toggleSwitch.style.transform = 'scale(1)';
                }, 100);
                
                if (item.state) {
                    toggleSwitch.classList.add('active');
                    toggleSwitch.style.boxShadow = '0 0 10px var(--primary-glow)';
                } else {
                    toggleSwitch.classList.remove('active');
                    toggleSwitch.style.boxShadow = 'none';
                }
                
                console.log('Toggle ' + id + ': ' + (item.state ? 'ON' : 'OFF'));
                showNotification(item.text + ' ' + (item.state ? 'Enabled' : 'Disabled'));
            }
        }
        
        function goBack() {
            if (menuHistory.length > 0) {
                currentMenu = menuHistory.pop();
                renderMenu(currentMenu);
            }
        }
        
        function updateSelection() {
            var menuItems = document.querySelectorAll('.menu-item');
            for (var i = 0; i < menuItems.length; i++) {
                if (i === selectedIndex) {
                    menuItems[i].classList.add('selected');
                } else {
                    menuItems[i].classList.remove('selected');
                }
            }
            
            // Auto scroll to keep selected item visible
            var visibleItems = 8;
            var maxScroll = Math.max(0, menuItems.length - visibleItems);
            
            if (selectedIndex < scrollOffset) {
                scrollOffset = selectedIndex;
            } else if (selectedIndex >= scrollOffset + visibleItems) {
                scrollOffset = selectedIndex - visibleItems + 1;
            }
            
            updateScroll();
        }
        
        function updateScroll() {
            var menuItems = document.querySelectorAll('.menu-item');
            var menuItemsContainer = document.getElementById('menuItems');
            var scrollThumb = document.getElementById('scrollThumb');
            
            var itemHeight = 37;
            var visibleItems = 8;
            var actualItemCount = menuItems.length;
            var maxDisplayItems = Math.min(actualItemCount, visibleItems);
            var containerHeight = maxDisplayItems * itemHeight;
            var maxScroll = Math.max(0, actualItemCount - visibleItems);
            
            scrollOffset = Math.max(0, Math.min(maxScroll, scrollOffset));
            var translateY = -scrollOffset * itemHeight;
            menuItemsContainer.style.transform = 'translateY(' + translateY + 'px)';
            
            // Update scrollbar thumb
            if (maxScroll > 0) {
                var thumbHeight = Math.max(20, (visibleItems / actualItemCount) * containerHeight);
                var thumbPosition = (scrollOffset / maxScroll) * (containerHeight - thumbHeight);
                scrollThumb.style.height = thumbHeight + 'px';
                scrollThumb.style.top = thumbPosition + 'px';
            } else {
                scrollThumb.style.height = containerHeight + 'px';
                scrollThumb.style.top = '0px';
            }
        }

        // Event listeners
        if (document.getElementById('searchInput')) {
            document.getElementById('searchInput').addEventListener('input', function(e) {
                performSearch(e.target.value);
            });
        }

        if (document.getElementById('backButton')) {
            document.getElementById('backButton').onclick = function() {
                goBack();
            };
        }

        // Close search when clicking outside
        document.addEventListener('click', function(e) {
            var searchContainer = document.getElementById('searchContainer');
            if (searchActive && searchContainer && !searchContainer.contains(e.target)) {
                hideSearch();
            }
        });

        // Close theme modal when clicking outside
        document.addEventListener('click', function(e) {
            var themeModal = document.getElementById('themeModal');
            if (themeModal && themeModal.classList.contains('visible') && e.target === themeModal) {
                closeThemeSelector();
            }
        });

        // Test function for DUI communication
        window.testMenuFunction = function() {
            console.log('Test function called from DUI!');
            showNotification('JavaScript is working!');
            return true;
        };

        // Initialize menu
        console.log('Menu script loaded, initializing...');
        setTimeout(function() {
            renderMenu('main');
            console.log('Menu initialized');
        }, 100);
    </script>
</body>
</html>
